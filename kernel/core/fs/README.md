# AetherOS ファイルシステム

AetherOSの高性能ファイルシステム実装の概要です。

## アーキテクチャ

AetherOSファイルシステムは以下の層で構成されています：

1. **仮想ファイルシステム (VFS)** - すべてのファイルシステムの抽象化レイヤー
2. **キャッシュ** - 高速なデータアクセスのためのブロックおよびアイノードキャッシュ
3. **ジャーナリング** - クラッシュ耐性と整合性のためのトランザクション機能
4. **具体的なファイルシステム実装**
   - Ext4 - Linux互換の高性能ファイルシステム
   - FAT32 - 相互運用性のための単純なファイルシステム
   - Btrfs - 先進的な機能を持つファイルシステム

## 主な機能

### VFS (仮想ファイルシステム)

- 統一されたファイルシステムインターフェース
- 透過的なマウントポイント管理
- 抽象化されたファイルおよびディレクトリ操作
- プラグ可能なファイルシステムドライバ

### キャッシュシステム

- LRUベースのブロックキャッシュ
- アイノードキャッシング
- 参照カウント
- 効率的なキャッシュ置換ポリシー

### ジャーナリング

- 堅牢なクラッシュリカバリ
- トランザクションベースの操作
- メタデータおよびデータのジャーナリング
- チェックポイント機構

### トランザクション処理

- アトミックなファイルシステム操作
- 簡易なトランザクションAPI
- 自動ロールバック
- ネスト可能なトランザクション

### Ext4実装

- Linuxとの互換性
- エクステントベースのブロックマッピング
- 高度なジャーナリング
- 大規模なファイルとファイルシステムのサポート

## 使用方法

### ファイルシステムの初期化

```rust
// ファイルシステムサブシステムを初期化
fs::init().expect("ファイルシステムの初期化に失敗しました");

// Ext4ファイルシステムをマウント
fs::mount("ext4", "/dev/sda1", "/", "rw").expect("マウントに失敗しました");
```

### ファイル操作

```rust
// ファイルオープン
let file = fs::open_file("/path/to/file", fs::OpenMode::ReadWrite).expect("ファイルオープンに失敗");

// ファイル読み取り
let mut buf = vec![0; 1024];
let bytes_read = file.read(&mut buf, 0).expect("読み取りに失敗");

// ファイル書き込み
let data = b"Hello, world!";
let bytes_written = file.write(data, 0).expect("書き込みに失敗");

// ファイルのフラッシュ
file.flush().expect("フラッシュに失敗");
```

### ディレクトリ操作

```rust
// ディレクトリオープン
let dir = fs::open_directory("/path/to/dir").expect("ディレクトリオープンに失敗");

// エントリの読み取り
let entries = dir.read_entries().expect("エントリ読み取りに失敗");

// 新しいファイルの作成
let file = dir.create_file("newfile.txt", Permissions::default()).expect("ファイル作成に失敗");

// 新しいディレクトリの作成
dir.create_directory("newdir", Permissions::default()).expect("ディレクトリ作成に失敗");
```

### トランザクション処理

```rust
// トランザクションを使用した複数操作
fs::with_transaction(|tx| {
    // 複数のファイルシステム操作を実行
    // すべての操作が成功した場合のみコミットされる
    Ok(())
}).expect("トランザクションに失敗");
```

## 性能最適化

- 効率的なブロックおよびアイノードキャッシング
- エクステントベースのブロックマッピング
- 非同期I/O操作
- インテリジェントなプリフェッチ
- ライトバックキャッシング 